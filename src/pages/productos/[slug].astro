---
import { getCollection, getEntryBySlug } from 'astro:content';
import ProductGallery from '../../components/ProductGallery.jsx';
import Layout from '../../layouts/Layout.astro';

// GeneraciÃ³n de rutas
export async function getStaticPaths() {
  const productos = await getCollection('productos');
  return productos.map((producto) => ({
    params: { slug: producto.slug },
    props: { product: producto },
  }));
}

const { product } = Astro.props;

if (!product) {
  throw new Error(`Producto no encontrado: ${Astro.params.slug}`);
}

const { data } = product;

// Formatear precio
const formatPrice = (price) =>
  new Intl.NumberFormat('es-CO', {
    style: 'currency',
    currency: 'COP',
    minimumFractionDigits: 0,
  }).format(price);

// URL dinÃ¡mica para WhatsApp
const whatsappMessage = encodeURIComponent(`Hola! Estoy interesad@ en el producto: ${data.title} ğŸ˜`);
const whatsappURL = `https://wa.me/573003637117?text=${whatsappMessage}`;
---
<Layout title={`${data.title} | InColors Kawaii`}>
  <main class="max-w-6xl mx-auto p-4 my-6 bg-white rounded-2xl shadow-xl border-4 border-pink-200">

    <a href="/#catalogo" class="text-pink-500 hover:underline text-lg mb-4 block">â† Volver al catÃ¡logo</a>

<!-- ğŸ§© Grid: Carrusel + Info principal -->
<div class="grid grid-cols-1 md:grid-cols-[3fr_2fr] gap-8 items-start">
  <!-- ğŸ–¼ï¸ GalerÃ­a -->
  <div>
    <div class="max-h-[500px] overflow-hidden rounded-xl shadow-md">
      <ProductGallery images={data.images} client:visible />
    </div>
  </div>

  <!-- ğŸ“‹ Info principal (sin descripcion) -->
  <div>
    <h1 class="text-3xl font-bold text-pink-600 mb-2">ğŸ€ {data.title}</h1>

    <p class="text-xl mb-4">
      ğŸ’µ Precio: <span class="font-semibold text-green-600">{formatPrice(data.price)}</span>
    </p>

    <div class="grid sm:grid-cols-2 gap-4 text-sm text-gray-700">
      <div>
        <h3 class="font-bold text-pink-500 mb-1">ğŸ¨ Colores:</h3>
        <ul class="list-disc ml-5">
          {data.colors?.map((color) => <li>{color}</li>)}
        </ul>
      </div>
      <div>
        <h3 class="font-bold text-pink-500 mb-1">ğŸ“ Medidas:</h3>
        <ul class="list-disc ml-5">
          {Object.entries(data.measures || {}).map(([key, val]) => (
            <li><strong>{key}:</strong> {val}</li>
          ))}
        </ul>
      </div>
    </div>

    <!-- ğŸ›’ Botones -->
    <div class="flex flex-col sm:flex-row gap-4 mt-6">
      <a
        href="https://incolorskawaii.github.io/gallery-notion/Carrito/carrito.html"
        target="_blank"
        class="flex-1 bg-pink-400 hover:bg-pink-500 text-white font-bold py-2 px-6 rounded-full shadow-md text-center transition duration-300"
      >
        ğŸ›ï¸ Agregar al carrito
      </a>
      <a
        href={whatsappURL}
        target="_blank"
        class="flex-1 bg-green-400 hover:bg-green-500 text-white font-bold py-2 px-6 rounded-full shadow-md text-center transition duration-300"
      >
        ğŸ’¬ Preguntar por WhatsApp
      </a>
    </div>
  </div>
</div>

<!-- ğŸ“„ DescripciÃ³n larga (100%) -->
<div class="whitespace-pre-wrap text-base leading-relaxed bg-pink-50 p-4 rounded-xl text-gray-700 my-6">
  {data.description}
</div>



        <!-- ğŸ›’ Botones -->
        <div class="flex flex-col sm:flex-row gap-4 mt-6">
          <a
            href="https://incolorskawaii.github.io/gallery-notion/Carrito/carrito.html"
            target="_blank"
            class="flex-1 bg-pink-400 hover:bg-pink-500 text-white font-bold py-2 px-6 rounded-full shadow-md text-center transition duration-300"
          >
            ğŸ›ï¸ Agregar al carrito
          </a>
          <a
            href={whatsappURL}
            target="_blank"
            class="flex-1 bg-green-400 hover:bg-green-500 text-white font-bold py-2 px-6 rounded-full shadow-md text-center transition duration-300"
          >
            ğŸ’¬ Preguntar por WhatsApp
          </a>
        </div>
      </div>
    </div>

    <!-- ğŸ·ï¸ Etiquetas -->
    <section class="mt-8">
      <h3 class="text-lg font-semibold text-pink-500">ğŸ·ï¸ Etiquetas:</h3>
      <div class="flex flex-wrap gap-2 mt-2">
        {data.tags?.map((tag) => (
          <span class="bg-pink-100 text-pink-600 text-xs font-medium px-3 py-1 rounded-full shadow-sm">
            #{tag}
          </span>
        ))}
      </div>
    </section>

    <!-- ğŸ§¡ Productos relacionados (estructura base) -->
    <section class="mt-12">
      <h2 class="text-2xl font-bold text-purple-500 mb-4">ğŸ’– Tambien te puede gustar</h2>
      <div class="grid sm:grid-cols-2 md:grid-cols-3 gap-6">
        <!-- Estructura base de producto relacionado -->
        <div class="bg-white border border-pink-200 rounded-xl p-4 shadow hover:shadow-lg transition">
          <img src="/images/products/kitminipapeleria1foto.jpg" alt="Producto relacionado" class="w-full rounded-lg mb-2" />
          <h3 class="text-pink-600 font-bold text-lg">Kit Mini Maleta</h3>
          <p class="text-green-600 font-semibold">ğŸ’µ $68.500</p>
          <a href="/producto/kit-mini-maleta" class="text-pink-500 hover:underline mt-2 block">Ver producto â†’</a>
        </div>
        <!-- Puedes aÃ±adir mÃ¡s como este manualmente o generar dinÃ¡micamente luego -->
      </div>
    </section>
  </main>
</Layout>
