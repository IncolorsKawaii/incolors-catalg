---
// CartSidebar.astro
---
<div id="cart-sidebar" class="cart-sidebar hidden">
  <div class="cart-header">
    <h2>🛍️ Tu carrito kawaii</h2>
    <button id="close-cart">✖️</button>
  </div>
  <div id="cart-items" class="cart-items">
    <p>Tu carrito esta vacio 😿</p>
  </div>
  <div class="cart-footer">
    <div class="total">Total: <span id="cart-total">$0</span></div>
    <button id="go-to-cart">Ver pedido completo</button>
  </div>
</div>

<style>
  .cart-sidebar {
    position: fixed;
    top: 0;
    right: 0;
    width: 320px;
    height: 100%;
    background-color: #fff0f6;
    box-shadow: -5px 0 15px rgba(255, 192, 203, 0.6);
    padding: 1rem;
    z-index: 9999;
    transform: translateX(100%);
    transition: transform 0.3s ease-in-out;
    display: flex;
    flex-direction: column;
  }
  .cart-sidebar.show {
    transform: translateX(0);
  }
  .cart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }
  .cart-items {
    flex: 1;
    overflow-y: auto;
  }
  .cart-footer {
    margin-top: 1rem;
    text-align: center;
  }
  #cart-sidebar button {
    background: linear-gradient(135deg, #ff80ab, #ff4081);
    border: none;
    color: white;
    border-radius: 24px;
    padding: 0.5rem 1rem;
    font-weight: bold;
    cursor: pointer;
  }
  .total {
    font-weight: bold;
    margin-bottom: 0.5rem;
    color: #c2185b;
  }
</style>

<script type="module">
  const sidebar = document.getElementById('cart-sidebar');
  const closeBtn = document.getElementById('close-cart');
  const cartItems = document.getElementById('cart-items');
  const cartTotal = document.getElementById('cart-total');
  const btnGoToCart = document.getElementById('go-to-cart');

  window.addEventListener('open-cart', () => {
    sidebar.classList.add('show');
    loadCart();
  });

  closeBtn.addEventListener('click', () => {
    sidebar.classList.remove('show');
  });

  btnGoToCart.addEventListener('click', () => {
    window.location.href = '/carrito';
  });

  function loadCart() {
    const cart = JSON.parse(localStorage.getItem('cart') || '[]');
    cartItems.innerHTML = '';
    if (cart.length === 0) {
      cartItems.innerHTML = '<p>Tu carrito esta vacio 😿</p>';
      cartTotal.textContent = '$0';
      return;
    }
    let total = 0;
    cart.forEach(item => {
      total += item.price * item.quantity;
      const div = document.createElement('div');
      div.innerHTML = `
        <div style="display:flex;align-items:center;margin-bottom:1rem;gap:0.5rem">
          <img src="${item.image}" style="width:60px;height:60px;border-radius:12px;object-fit:cover">
          <div style="flex:1">
            <strong>${item.title}</strong><br>
            <small>$${item.price} x ${item.quantity}</small>
          </div>
          <button onclick="removeFromCart('${item.slug}')">🗑️</button>
        </div>`;
      cartItems.appendChild(div);
    });
    cartTotal.textContent = `$${total.toLocaleString('es-CO')}`;
  }

  window.removeFromCart = function(slug) {
    let cart = JSON.parse(localStorage.getItem('cart') || '[]');
    cart = cart.filter(p => p.slug !== slug);
    localStorage.setItem('cart', JSON.stringify(cart));
    loadCart();
  }
</script>
